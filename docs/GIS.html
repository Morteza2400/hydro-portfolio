<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>GIS Showcase – Morteza Imani</title>
  <link rel="stylesheet" href="css/styles.css"/>

  <!-- Leaflet + Esri (same versions you’re using) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/esri-leaflet@3.0.11/dist/esri-leaflet.js"></script>

  <!-- MarkerCluster + Esri Leaflet Cluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/esri-leaflet-cluster@3.0.0/dist/esri-leaflet-cluster.js"></script>

  <!-- Charts + Turf -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>
</head>
<body>
  <!-- NAV -->
  <div class="nav">
    <div class="container nav-inner">
      <a class="brand" href="index.html"><span class="dot"></span><strong>Morteza Imani</strong></a>
      <nav>
        <a href="index.html">About</a>
        <a class="active" href="gis.html">GIS Showcase</a>
        <a href="research.html">Research</a>
        <a href="code.html">Modelling</a>
      </nav>
    </div>
  </div>

  <main class="container">
    <div class="card">
      <h2>Interactive Map</h2>
      <p class="muted">Live layers from LocationSA + Fire Ban Districts overlay. Water Mains on by default.</p>
      <!-- Your map container; app.js will populate controls, charts, and tables as before -->
      <div id="map"></div>
      <p class="muted" id="scaleHint"></p>
    </div>

    <!-- Analytics block is created by your current app.js (tables + charts).
         If your app.js expects certain DOM IDs, ensure they’re present below. -->
    <div class="grid2" style="margin-top:16px">
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h2>Analytics (Current View)</h2>
          <div>
            <label class="muted" for="diamMin">Filter Water Mains ≥</label>
            <input id="diamMin" type="number" min="0" step="1" placeholder="mm" style="width:100px">
            <button id="applyFilter" class="btn" type="button">Apply</button>
            <button id="clearFilter" class="btn" type="button">Clear</button>
            <button id="refreshBtn" class="btn" type="button">Refresh</button>
          </div>
        </div>
        <div class="grid2">
          <figure class="chart"><canvas id="barChart"></canvas></figure>
          <figure class="chart"><canvas id="pieChart"></canvas></figure>
        </div>
        <div class="grid2">
          <table id="summaryTable" class="tbl">
            <thead><tr><th>Metric</th><th>Value</th></tr></thead><tbody></tbody>
          </table>
          <table id="diamTable" class="tbl">
            <thead><tr><th>Nominal Diameter (mm)</th><th>Length in View (km)</th></tr></thead><tbody></tbody>
          </table>
        </div>
      </div>
      <div class="card">
        <h2>Legend</h2>
        <p class="muted">Use the layer control on the map (top-right) to toggle data. Hydrant layers are clustered for performance.</p>
        <ul>
          <li><span style="color:#1e88e5">■</span> Water Main</li>
          <li><span style="color:#6f42c1">■</span> Reclaimed Main</li>
          <li><span style="color:#14b8a6">■</span> WW Gravity</li>
          <li><span style="color:#789262">■</span> WW Low Pressure</li>
          <li><span style="color:#ec4899">■</span> WW Pumping</li>
          <li><span style="color:#8d6e63">■</span> WW Vacuum</li>
          <li>● Hydrant (red), ● Pillar Hydrant (orange)</li>
          <li>■ Fire Ban Districts (amber fill)</li>
        </ul>
      </div>
    </div>
  </main>

  <footer class="container">© <span id="y"></span> Morteza Imani · GIS Showcase</footer>
  <script>document.getElementById('y').textContent=new Date().getFullYear()</script>

  <!-- Your existing logic -->
  <script src="js/app.js"></script>
</body>
</html>
